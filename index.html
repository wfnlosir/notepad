<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Notepad</title>
  <style>
    :root {
      --bg: #ffffff;
      --fg: #111111;
      --muted: #666;
      --accent: #0b57d0;
      --border: #ddd;
      --menu-bg: #f7f7f7;
      --menu-hover: #e9eef6;
      --status-bg: #f8f8f8;
      --font: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--fg);
    }
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    /* Simple title bar / menu */
    header {
      background: var(--menu-bg);
      border-bottom: 1px solid var(--border);
    }
    .menubar {
      display: flex;
      gap: 4px;
      padding: 6px 8px;
      overflow-x: auto;
    }
    .menu {
      position: relative;
    }
    .menu > button {
      background: transparent;
      border: 0;
      padding: 6px 8px;
      border-radius: 4px;
      font: 14px/1.2 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      color: var(--fg);
      cursor: pointer;
    }
    .menu > button:hover,
    .menu > button:focus-visible {
      background: var(--menu-hover);
      outline: none;
    }
    .dropdown {
      position: absolute;
      top: calc(100% + 2px);
      left: 0;
      min-width: 220px;
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 6px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
      padding: 6px;
      display: none;
      z-index: 10;
    }
    .dropdown.open { display: block; }
    .item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 8px 10px;
      border-radius: 4px;
      cursor: pointer;
      user-select: none;
      font: 14px/1.2 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }
    .item:hover { background: var(--menu-hover); }
    .item[aria-disabled="true"] {
      color: var(--muted);
      cursor: not-allowed;
    }
    .sep {
      height: 1px;
      background: var(--border);
      margin: 6px;
    }
    main {
      flex: 1;
      display: flex;
      min-height: 0;
    }
    textarea {
      width: 100%;
      flex: 1;
      border: none;
      resize: none;
      padding: 12px;
      font: 14px/1.6 var(--font);
      outline: none;
      background: var(--bg);
      color: var(--fg);
      tab-size: 4;
      caret-color: var(--accent);
      white-space: pre-wrap; /* default word wrap ON */
      overflow-wrap: anywhere;
    }
    textarea.nowrap {
      white-space: pre;     /* word wrap OFF */
      overflow-wrap: normal;
      overflow: auto;
    }
    footer {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 6px 10px;
      border-top: 1px solid var(--border);
      background: var(--status-bg);
      font: 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      color: #333;
    }
    .status-right {
      margin-left: auto;
      display: inline-flex;
      gap: 12px;
      align-items: center;
      white-space: nowrap;
    }
    /* Mobile tweaks */
    @media (max-width: 640px) {
      .dropdown { min-width: min(90vw, 320px); }
      textarea { font-size: 15px; }
      .kbd { display: none; }
    }
    .hidden-input {
      display: none;
    }
    .kbd {
      font-family: var(--font);
      font-size: 12px;
      color: #666;
      background: #f1f1f1;
      padding: 1px 6px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    .dot {
      color: var(--accent);
      margin-left: 4px;
      visibility: hidden;
    }
    .dirty .dot { visibility: visible; }
    .link {
      color: var(--accent);
      text-decoration: none;
    }
    .link:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <header>
    <div class="menubar">
      <div class="menu" data-menu="file">
        <button type="button" aria-haspopup="true" aria-expanded="false">File</button>
        <div class="dropdown" role="menu">
          <div class="item" data-action="new"><span>New</span><span class="kbd">Ctrl/Cmd+N</span></div>
          <div class="item" data-action="open"><span>Open…</span><span class="kbd">Ctrl/Cmd+O</span></div>
          <div class="item fs-supported" data-action="save"><span>Save</span><span class="kbd">Ctrl/Cmd+S</span></div>
          <div class="item" data-action="saveas"><span>Save As…</span></div>
          <div class="sep"></div>
          <div class="item" data-action="download"><span>Download .txt</span></div>
        </div>
      </div>
      <div class="menu" data-menu="edit">
        <button type="button" aria-haspopup="true" aria-expanded="false">Edit</button>
        <div class="dropdown" role="menu">
          <div class="item" data-action="undo">Undo</div>
          <div class="item" data-action="redo">Redo</div>
          <div class="sep"></div>
          <div class="item" data-action="cut">Cut</div>
          <div class="item" data-action="copy">Copy</div>
          <div class="item" data-action="paste">Paste</div>
          <div class="sep"></div>
          <div class="item" data-action="selectall">Select All</div>
        </div>
      </div>
      <div class="menu" data-menu="view">
        <button type="button" aria-haspopup="true" aria-expanded="false">View</button>
        <div class="dropdown" role="menu">
          <div class="item" data-action="toggle-wrap"><span>Word Wrap</span><span id="wrapState" class="kbd">On</span></div>
          <div class="item" data-action="zoom-in">Zoom In</div>
          <div class="item" data-action="zoom-out">Zoom Out</div>
          <div class="item" data-action="zoom-reset">Reset Zoom</div>
        </div>
      </div>
      <div class="menu" data-menu="help">
        <button type="button" aria-haspopup="true" aria-expanded="false">Help</button>
        <div class="dropdown" role="menu">
          <div class="item" data-action="about">About</div>
        </div>
      </div>
      <span id="title" style="margin-left:auto;padding:6px 8px;">Notepad</span><span class="dot">•</span>
    </div>
  </header>

  <main>
    <textarea id="editor" spellcheck="false" placeholder="Start typing..."></textarea>
    <input id="fileInput" class="hidden-input" type="file" accept=".txt,text/plain" />
  </main>

  <footer>
    <span id="status">Ready</span>
    <div class="status-right">
      <span id="cursorPos">Ln 1, Col 1</span>
      <span>|</span>
      <span id="length">0 chars</span>
      <span>|</span>
      <span id="wrapLabel">Wrap: On</span>
    </div>
  </footer>

  <script>
    // State
    let fileHandle = null; // File System Access API handle
    let fileName = "Untitled.txt";
    let isDirty = false;
    let wrapOn = true;
    let zoom = 1;

    const editor = document.getElementById('editor');
    const titleEl = document.getElementById('title');
    const statusEl = document.getElementById('status');
    const cursorPosEl = document.getElementById('cursorPos');
    const lengthEl = document.getElementById('length');
    const wrapLabelEl = document.getElementById('wrapLabel');
    const wrapStateEl = document.getElementById('wrapState');
    const fileInput = document.getElementById('fileInput');

    // Restore autosaved content and settings
    (function init() {
      try {
        const saved = localStorage.getItem('notepad:text');
        if (saved !== null) editor.value = saved;
        const savedFileName = localStorage.getItem('notepad:filename');
        if (savedFileName) fileName = savedFileName;
        const savedWrap = localStorage.getItem('notepad:wrap');
        if (savedWrap) wrapOn = savedWrap === 'true';
        const savedZoom = parseFloat(localStorage.getItem('notepad:zoom') || '1');
        if (!isNaN(savedZoom)) setZoom(savedZoom, false);

        applyWrap();
        markClean(); // start as clean with restored text
        updateTitle();
        updateStats();
      } catch (e) {
        console.warn('Init error', e);
      }

      // Detect File System Access API support
      const fsSupported = 'showOpenFilePicker' in window && 'showSaveFilePicker' in window;
      document.querySelectorAll('.fs-supported').forEach(el => {
        if (!fsSupported) el.setAttribute('aria-disabled', 'true');
      });

      // Close menus when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.menu')) closeAllMenus();
      });
      document.addEventListener('keydown', handleShortcuts);
      editor.addEventListener('input', handleInput);
      editor.addEventListener('click', updateCursorPos);
      editor.addEventListener('keyup', updateCursorPos);
      fileInput.addEventListener('change', handleFileInput);
    })();

    function updateTitle() {
      titleEl.textContent = fileName.replace(/\s+/g, ' ').trim() || 'Notepad';
      document.body.classList.toggle('dirty', isDirty);
    }
    function markDirty() {
      isDirty = true;
      updateTitle();
    }
    function markClean() {
      isDirty = false;
      updateTitle();
    }
    function handleInput() {
      localStorage.setItem('notepad:text', editor.value);
      localStorage.setItem('notepad:filename', fileName);
      updateStats();
      markDirty();
    }
    function updateStats() {
      lengthEl.textContent = `${editor.value.length} chars`;
      updateCursorPos();
    }
    function updateCursorPos() {
      const pos = editor.selectionStart || 0;
      const before = editor.value.slice(0, pos);
      const line = (before.match(/\n/g) || []).length + 1;
      const col = pos - before.lastIndexOf('\n');
      cursorPosEl.textContent = `Ln ${line}, Col ${col}`;
    }

    // Menus
    document.querySelectorAll('.menu > button').forEach(btn => {
      btn.addEventListener('click', () => {
        const dd = btn.nextElementSibling;
        const expanded = dd.classList.toggle('open');
        btn.setAttribute('aria-expanded', expanded ? 'true' : 'false');
        document.querySelectorAll('.dropdown').forEach(other => {
          if (other !== dd) other.classList.remove('open');
        });
      });
    });
    document.querySelectorAll('.dropdown .item').forEach(item => {
      item.addEventListener('click', async () => {
        if (item.getAttribute('aria-disabled') === 'true') return;
        const action = item.dataset.action;
        closeAllMenus();
        switch (action) {
          case 'new': await doNew(); break;
          case 'open': await doOpen(); break;
          case 'save': await doSave(); break;
          case 'saveas': await doSaveAs(); break;
          case 'download': doDownload(); break;
          case 'undo': document.execCommand('undo'); break;
          case 'redo': document.execCommand('redo'); break;
          case 'cut': document.execCommand('cut'); break;
          case 'copy': document.execCommand('copy'); break;
          case 'paste': document.execCommand('paste'); break;
          case 'selectall': editor.select(); break;
          case 'toggle-wrap': toggleWrap(); break;
          case 'zoom-in': setZoom(zoom + 0.1); break;
          case 'zoom-out': setZoom(Math.max(0.5, zoom - 0.1)); break;
          case 'zoom-reset': setZoom(1); break;
          case 'about': showAbout(); break;
        }
      });
    });
    function closeAllMenus() {
      document.querySelectorAll('.dropdown').forEach(dd => dd.classList.remove('open'));
      document.querySelectorAll('.menu > button').forEach(btn => btn.setAttribute('aria-expanded', 'false'));
    }

    // Actions
    async function doNew() {
      if (isDirty && !confirm('Discard unsaved changes?')) return;
      editor.value = '';
      fileHandle = null;
      fileName = 'Untitled.txt';
      localStorage.setItem('notepad:text', '');
      localStorage.setItem('notepad:filename', fileName);
      markClean();
      updateStats();
      status('New file');
      editor.focus();
    }

    async function doOpen() {
      // Try File System Access API first
      if ('showOpenFilePicker' in window) {
        try {
          const [handle] = await window.showOpenFilePicker({
            multiple: false,
            types: [{ description: 'Text Files', accept: { 'text/plain': ['.txt'] } }]
          });
          const file = await handle.getFile();
          const text = await file.text();
          editor.value = text;
          fileHandle = handle;
          fileName = file.name || 'Untitled.txt';
          localStorage.setItem('notepad:text', editor.value);
          localStorage.setItem('notepad:filename', fileName);
          markClean();
          updateStats();
          status('Opened ' + fileName);
          return;
        } catch (e) {
          if (e.name !== 'AbortError') console.warn(e);
        }
      }
      // Fallback: hidden file input
      fileInput.value = '';
      fileInput.click();
    }

    async function handleFileInput(e) {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      const text = await file.text();
      editor.value = text;
      fileHandle = null; // not writable handle
      fileName = file.name || 'Untitled.txt';
      localStorage.setItem('notepad:text', editor.value);
      localStorage.setItem('notepad:filename', fileName);
      markClean();
      updateStats();
      status('Opened ' + fileName);
    }

    async function doSave() {
      // If we have a file handle, write directly
      if (fileHandle && 'createWritable' in fileHandle) {
        await writeFileHandle(fileHandle, editor.value);
        markClean();
        status('Saved ' + fileName);
        return;
      }
      // If File System Access API is available, prompt Save As first time
      if ('showSaveFilePicker' in window) {
        await doSaveAs();
        return;
      }
      // Fallback: download
      doDownload();
    }

    async function doSaveAs() {
      if ('showSaveFilePicker' in window) {
        try {
          const handle = await window.showSaveFilePicker({
            suggestedName: fileName || 'Untitled.txt',
            types: [{ description: 'Text Files', accept: { 'text/plain': ['.txt'] } }]
          });
          await writeFileHandle(handle, editor.value);
          fileHandle = handle;
          fileName = (await handle.getFile()).name || fileName;
          localStorage.setItem('notepad:filename', fileName);
          markClean();
          status('Saved ' + fileName);
          return;
        } catch (e) {
          if (e.name !== 'AbortError') {
            console.error(e);
            alert('Save failed: ' + e.message);
          }
        }
      } else {
        doDownload();
      }
    }

    function doDownload() {
      const blob = new Blob([editor.value], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = fileName || 'Untitled.txt';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(a.href);
      markClean();
      status('Downloaded ' + a.download);
    }

    async function writeFileHandle(handle, contents) {
      const writable = await handle.createWritable();
      await writable.write(contents);
      await writable.close();
    }

    function status(msg) {
      statusEl.textContent = msg;
      setTimeout(() => {
        if (statusEl.textContent === msg) statusEl.textContent = 'Ready';
      }, 2000);
    }

    function toggleWrap() {
      wrapOn = !wrapOn;
      localStorage.setItem('notepad:wrap', String(wrapOn));
      applyWrap();
    }
    function applyWrap() {
      editor.classList.toggle('nowrap', !wrapOn);
      wrapLabelEl.textContent = 'Wrap: ' + (wrapOn ? 'On' : 'Off');
      wrapStateEl.textContent = wrapOn ? 'On' : 'Off';
    }

    function setZoom(value, persist = true) {
      zoom = Math.max(0.5, Math.min(2, value));
      editor.style.fontSize = (14 * zoom) + 'px';
      if (persist) localStorage.setItem('notepad:zoom', String(zoom));
    }

    function showAbout() {
      alert('Notepad (browser) — simple, private, and free.\n\nTips:\n- Autosaves to your browser\n- Ctrl/Cmd+S: Save (or Download)\n- Ctrl/Cmd+O: Open\n- Ctrl/Cmd+N: New\n- Ctrl/Cmd+W: Toggle word wrap');
    }

    // Keyboard shortcuts
    function isMod(e) { return e.ctrlKey || e.metaKey; }
    async function handleShortcuts(e) {
      // Ignore shortcuts if focused in an input other than editor
      const tag = e.target.tagName.toLowerCase();
      if (!['textarea', 'input', 'body'].includes(tag)) return;

      if (isMod(e) && e.key.toLowerCase() === 's') {
        e.preventDefault();
        await doSave();
      } else if (isMod(e) && e.key.toLowerCase() === 'o') {
        e.preventDefault();
        await doOpen();
      } else if (isMod(e) && e.key.toLowerCase() === 'n') {
        e.preventDefault();
        await doNew();
      } else if (isMod(e) && e.key.toLowerCase() === 'w') {
        e.preventDefault();
        toggleWrap();
      }
    }

    // Warn on close if unsaved changes
    window.addEventListener('beforeunload', (e) => {
      if (isDirty) {
        e.preventDefault();
        e.returnValue = '';
      }
    });
  </script>
</body>
</html>
